/** Data Binding functions for Browser. @preserve Copyright (c) 2020 Manuel Lï¿½hmus.*/
(function(n,t){n=typeof globalThis!="undefined"?globalThis:n||self;n.DB=t(n.DB={},n.DC)})(this,function(n,t){function o(t,i,r,u){var f,e;t&&t!=="null"&&(f=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),f.open("GET",t),typeof u=="object"&&u!==null&&(e=Object.keys(u),e.forEach(function(n){f.setRequestHeader(n,u[n])})),f.onload=function(){typeof i=="function"&&i(f.responseText)},f.onerror=function(n){typeof r=="function"&&r(n)},f.onreadystatechange=function(){f.readyState===4&&n.Ajax.progressCount.value--},f.send(),n.Ajax.progressCount.value++)}function w(t,i,r,u,f){var e,o;t&&(e=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),e.open("POST",t),typeof f=="object"&&f!==null&&(o=Object.keys(f),o.forEach(function(n){e.setRequestHeader(n,f[n])})),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){typeof r=="function"&&r(e.responseText)},e.onerror=function(n){typeof u=="function"&&u(n)},e.onreadystatechange=function(){e.readyState===4&&n.Ajax.progressCount.value--},e.send(i),n.Ajax.progressCount.value++)}function b(n){var i=n&&n.attributes&&n.attributes.path?n.attributes.path.value:n.toString(),t;if(i&&typeof i=="string")return t=[],i.split(";").filter(function(n){return n!==undefined}).forEach(function(i){var r=i.split("="),u;r.length===1?(u=r[0][0]==="."?".":"",t=t.concat(h(u,r[0].trim(),n))):t=t.concat(h(r.shift().trim(),r.join("=").trim(),n))}),t}function h(n,t,i){var u=[],f,e,r=c(t,i);return r.isOperators&&(f=r.map(function(n){if(n.type==="path"&&n.value!==undefined&&typeof n.value!="function"){var i=n.keys.join(".");try{n.value&&n.value.value!==undefined&&(i+=".value")}catch(r){console.info("Parsing error!",t,r)}return i}return n.expr}).join(""),e=function(n){return function(){var t;try{t=Function("return "+n+";").call(r.element)}catch(i){console.info("Parsing error!",n,i)}return t}}(f)),r.forEach(function(t){t.type==="path"&&u.push({propertyName:n,path:t.expr,value:t.value,getCalcValue:e})}),u}function c(n,t){var i=[],e=t,o=!1,r;if(typeof n=="string"){var f={expr:"",type:"path"};for(i.push(f),r=0;r<n.length;r++)"=+-*/%<>&^|!~?:(),[]".indexOf(n[r])>-1?f.type==="operator"?f.expr+=n[r]:(i.push(f={expr:n[r],type:"operator"}),o=!0):f.type==="path"?f.expr+=n[r]:i.push(f={expr:n[r],type:"path"});i=i.filter(function(n){if(n.expr)return n.type==="path"&&(n.keys=u(n.expr,t),n.value=l(n.keys,n.keys.element),e.datacontext||(e=n.keys.element)),!0})}return i.element=e,i.isOperators=o,i}function u(n,t){function e(n){if(typeof n=="string"){var t=[];return n.split("[").forEach(function(n,i,r){n&&i>0&&r.length>1?n.split("]").forEach(function(n,i){n&&(i===0?((n[0]==="'"||n[0]==='"')&&(n=n.substr(1)),(n[n.length-1]==="'"||n[n.length-1]==='"')&&(n=n.substr(0,n.length-1)),t.push(n)):n.split(".").forEach(function(n){n&&t.push(n)}))}):n&&(t=t.concat(n.split(".")))}),t[0]===""&&(t[0]="datacontext"),t[t.length-1]===""&&t.pop(),t}return[]}var i=e(n),f,o,r,s;if(i.element=t,i[0]==="datacontext"&&n[0]===".")while(i[0]!=="this"&&t&&(t.parentElement||t.parentNode))t=t.parentElement||t.parentNode,t.getAttribute&&(n=t.getAttribute("path")),n&&(f="",n.split(";").forEach(function(n){if(n=n.trim(),(n.substr(0,4)==="this"||n[0]===".")&&n.indexOf("=")<0){f=n;return}}),f&&(o=e(f),i.shift(),i=o.concat(i),i.element=t));else if(i[0]!=="this"&&i[0]!=="window")while(t&&(t.parentElement||t.parentNode&&t.parentNode.getAttribute))t=t.parentElement||t.parentNode,n=t.getAttribute("path"),n&&(r="",n.split(";").forEach(function(n){if(n[0]!=="."&&n.indexOf("=")<0){r=n.trim();return}}),r&&r.substr(0,4)!=="this"&&(s=u(r),i=s.concat(i),i.element=t));return i}function l(i,r){var u=window;return i&&typeof i.forEach=="function"&&i.forEach(function(f){if(f==="window")u=window;else if(f==="this")u=r;else if(u)n.IsAutoProperty&&f!=="value"&&!u[f]&&typeof u.defineProperty=="function"&&(u.defineProperty(f,t.Item()),console.info("AutoProperty!","'"+f+"'",i.join("."))),u=u[f];else return}),u}function a(t){t&&(t.path&&t.path.length&&t.path.forEach&&t.path.forEach(function(i){if(i&&i.path&&i.value!==undefined)try{if(i.value&&i.value.isCollection)t.element.setAttribute("collection","true"),t.element.removeBinding=typeof t.callback=="function"?i.value.addBindCollection(t.callback,t.element):i.value.addBindCollection(k(i,t),t.element);else if(i&&i.value&&i.value.parentPropertyName){var r=i.value.parentPropertyName,u=i.value.parent;r!==undefined&&r!==null&&typeof u.addBind=="function"&&(t.element.removeBinding=typeof t.callback=="function"?u.addBind(r,t.callback,t.element):u.addBind(r,function(r,u,f){if(t.template&&y("template",t.element)!==t.template&&(!i.propertyName||i.propertyName===".datacontext")){u.innerHTML=t.template;var e=u.lastElementChild;e.datacontext=r;n.BindAll(e)}else v(i)(r,u,f)},t.element))}else i&&typeof i.value=="function"?i.propertyName[0]==="."?t.element[i.propertyName.slice(1)]=i.value():t.element.setAttribute(i.propertyName,i.value()):i&&typeof i.getCalcValue=="function"?i.propertyName[0]==="."?t.element[i.propertyName.slice(1)]=i.getCalcValue():t.element.setAttribute(i.propertyName,i.getCalcValue()):i.propertyName&&(i.propertyName[0]==="."?t.element[i.propertyName.slice(1)]=i.value:t.element.setAttribute(i.propertyName,i.value))}catch(f){console.info("Binding error!",i.path,f)}}),t.template&&t.element.getAttribute("collection")!=="true"&&!t.element.attributes.onbind&&(t.element.innerHTML=t.template,t.element.removeAttribute("template"),n.BindChildren(t.element)),t.templateid&&t.element.getAttribute("collection")!=="true"&&!t.element.attributes.onbind&&(t.element.innerHTML="",t.element.removeAttribute("templateid"),e(t.templateid,function(n){i(n,t.element,t.datacontext)})))}function k(t,r){return function(u,o,s){function h(n,u){function f(){n&&n.items&&n.items.forEach&&n.items.forEach(function(n){if(!n["-deleted"])if(r.template)i(r.template,u,n,t.path,n.parentPropertyName);else{var f=document.createElement("div");u.appendChild(f);f.removeBinding=t.value.addBind(n.parentPropertyName,v(t),f)}})}r.templateid?e(r.templateid,function(n){r.template=n;f()}):f()}function c(n,t){n&&n.items&&n.items.forEach&&n.items.forEach(function(n){for(var i=t.querySelectorAll("[name='"+n.parentPropertyName+"']"),r=i.length-1;i&&r>-1;r--)try{t.removeChild(i[r])}catch(u){console.info(u)}})}if(s&&s.newValue&&s.oldValue&&s.newValue["-type"]!==s.oldValue["-type"]){typeof o.removeBinding=="function"&&o.removeBinding();f(o);n.BindAll(o);return}if(u)switch(u.action){case"addBind":f(o);h(u,o);break;case"add":h(u,o);break;case"remove":c(u,o);break;case"modified":f(o);u.items=[];u.source.forEach(function(n){u.items.push(n)});h(u,o)}}}function f(n){if(n&&n.children&&n.removeChild)for(var t=n.children;n.children.length>0;)t[0].tagName&&t[0].tagName.toLowerCase()!=="template"&&n.removeChild(t[0])}function e(t,i,r){var u=n.BindDisableCache?{Pragma:"no-cache","Cache-Control":"no-store, no-cache, must-revalidate, post-check=0, pre-check=0",Expires:-1,"Last-Modified":Date(0),"If-Modified-Since":Date(0)}:null;o(t,i,r,u)}function d(n,t,i){var r,u,f;if(i=i?i:"",r=i[0]==="."||i.startsWith("this")?".":"",r)if(t&&n.attributes.path){if(i=n.attributes.path.value,i)return u=!1,f=i.split(";").filter(function(n){return n}).map(function(n){if(n){var t=n.split("=");if(t.length===1)return u=!0,{property:"",path:t[0].trim()};if(t.length===2)return{property:t.shift(),path:t.join("=").trim()}}}).map(function(i){return!i||i.property+"="+c(i.path,n).map(function(n){return n.type==="path"&&n.expr[0]==="."&&t.parentPropertyName.toString()?r+t.parentPropertyName+n.expr:n.expr}).join("")}).join(";"),u||(f+=t.parentPropertyName.toString()?";"+r+t.parentPropertyName:""),f}else if(t&&t.parentPropertyName)return r+t.parentPropertyName}function i(t,i,r,u,f){var o,e,s;if(t)for(o=i.parentElement?document.createElement(i.nodeName):document.createElementNS(i.namespaceURI,i.nodeName),o.innerHTML=t;o.childElementCount>0;)e=o.children[0],e.tagName.toLowerCase()==="script"?(n.AddScript(e.innerHTML,i),o.removeChild(e)):(i.appendChild(e),s=d(e,r,u),s!==undefined&&e.setAttribute("path",s),f!==undefined&&e.setAttribute("name",f),r!==undefined&&(e.datacontext=r),i.parentElement&&n.BindAll(e))}function v(t){return function(r,u){var f,h,o;if(!n.BindDisable){if(t&&t.propertyName==="."||!s){typeof t.getCalcValue=="function"&&t.getCalcValue();return}if(t.propertyName==="template"){u.innerHTML=t.value+"";n.BindChildren(u);return}if(t.propertyName==="templateid"){u.innerHTML="";e(t.value+"",function(t){i(t,u,n.GetDatacontext(".",u))});return}if(t&&t.propertyName)if(f=typeof t.getCalcValue=="function"?t.getCalcValue():r,(f===undefined||f===null)&&(f=r),f=f===undefined||f===null?"":f,f&&f.value!==undefined&&(f=f.value),t.propertyName[0]===".")try{for(h=t.propertyName.split(".").filter(function(n){return n?!0:!1}),o=u;o&&h.length>1;)o=o[h.shift()];o[h.shift()]=n.IsDebuger||f!==undefined&&f!==null?f:""}catch(c){console.info("Default callback error!",c)}else f?u.parentElement?u.setAttribute(t.propertyName,f.toString()):u.setAttributeNS(u.namespaceURI,t.propertyName,f.toString()):u.removeAttribute(t.propertyName);(t.propertyName.toLowerCase()==="value"||t.propertyName.toLowerCase()===".value")&&(u.tagName.toLowerCase()==="input"||u.tagName.toLowerCase()==="select"||u.tagName.toLowerCase()==="textarea")&&(u.onchange=function(n){return n[0]==="."&&(n=n.substr(1)),function(){r.parent&&typeof r.parent.setValue=="function"&&r.parentPropertyName&&r.parent.setValue(r.parentPropertyName,this[n])}}(t.propertyName),u.onkeydown=function(n){return n[0]==="."&&(n=n.substr(1)),function(){if(event.keyCode===27){var i=typeof t.getCalcValue=="function"?t.getCalcValue():r;(i===undefined||i===null)&&(i=r);i=i===undefined||i===null?"":i;i&&i.value!==undefined&&(i=i.value);this[n]=i}}}(t.propertyName));u.getAttribute("onclick")||t.propertyName.toLowerCase()!=="checked"&&t.propertyName.toLowerCase()!==".checked"||u.tagName.toLowerCase()!=="input"||(u.onclick=function(n){return n[0]==="."&&(n=n.substr(1)),function(){r.parent&&typeof r.parent.setValue=="function"&&r.parentPropertyName&&r.parent.setValue(r.parentPropertyName,this[n]?!0:!1)}}(t.propertyName))}}}function y(n,t){if(n&&t&&t.parentElement)return t.parentElement.attributes[n]?t.parentElement.attributes[n].value:y(n,t.parentElement)}function p(){if(n.Ajax.progressCount=0,!r){var t=document.getElementById("datacontext");if(t)try{t=JSON.parse(t.innerHTML);window.datacontext.init(t)}catch(i){this.console.info("error: loading 'datacontext' in scriptTextHtml",i)}n.BindAll();r=!0}}var s,r;if(n&&n.name==="DB")return n;if(n.name="DB",!t)throw new Error("Data Binding depends npm 'data-context'");return String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(n,t){var i=t>0?t|0:0;return typeof n=="string"&&this.substring(i,i+n.length)===n}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(n,t){return t=t===undefined||t>this.length?this.length:t,typeof n=="string"&&this.substring(t-n.length,t)===n}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{value:function(n){return this.startsWith(n)?this.substring(n.length):this.replace(/^[\s\uFEFF\xA0]+/g,"")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{value:function(n){return this.endsWith(n)?this.substring(0,this.length-n.length):this.replace(/[\s\uFEFF\xA0]+$/g,"")}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(n){return this.indexOf(n)>-1}}),Math.cbrt||Object.defineProperty(Math,"cbrt",{value:function(n){return n<0?-Math.pow(-n,1/3):Math.pow(n,1/3)}}),n.Ajax=t.Item({progressCount:0}),n.GET=o,n.POST=w,n.AddScript=function(n,t){var i=document.createElement("script");i.type="text/javascript";try{i.appendChild(document.createTextNode(n));t?t.appendChild(i):document.body.appendChild(i)}catch(r){i.text=n;t?t.appendChild(i):document.body.appendChild(i)}},n.CleanElement=function(n){var i,t,r;if(n)for(i=n.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),t=0;t<i.length;t++)i[t].parentElement&&i[t].parentElement.removeChild(i[t]);while(n&&n.childNodes.length)r=n.childNodes["0"],n.removeChild(n.childNodes["0"])},s=location.hostname.indexOf("tra.")>-1||document.querySelector("meta")&&document.querySelector("meta").content.indexOf("hmu")>-1,n.BindAll=function(t){var r,i;if((t||(t=document),!t.attributes||!t.attributes.isBinding)&&(!t.attributes||!t.attributes.isbinding)&&(!t.attributes||!t.attributes.isBinded)&&(!t.attributes||!t.attributes.isbinded))for(r=t.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),n.BindElement(t),i=0;i<r.length;i++)n.BindElement(r[i])},n.Bind=function(t){n.BindElement(t);n.BindChildren(t)},n.BindChildren=function(t){var r,i;if(t&&t.querySelectorAll)for(r=t.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),i=0;i<r.length;i++)n.BindElement(r[i])},n.BindElement=function(n){var t,r,i,o,u,e;if(n&&n.attributes&&!n.attributes.isBinding&&!n.attributes.isbinding&&!n.attributes.isBinded&&!n.attributes.isbinded&&(!n.tagName||n.tagName.toLowerCase()!=="template")&&(n.attributes.templateid||n.attributes.template||n.attributes.path||n.attributes.onbind||n.attributes.onbinded)){if(n.setAttribute("isBinding","true"),t={element:n,datacontext:n.datacontext,templateid:null,template:null,path:[],callback:null},n.attributes.templateid&&(r=n.attributes.templateid.value,i=document.getElementById(r),i&&i.innerHTML?t.template=i.innerHTML:t.templateid=r),n.attributes.template&&(t.template=n.attributes.template.value),n.attributes.path&&(t.path=b(n)),n.attributes.onbind){u=Function(n.attributes.onbind.value);try{o=u.apply(t)}catch(f){console.info("onbind error!",f,n.attributes.onbind?n.attributes.onbind.value:undefined)}}if(a(t),n.removeAttribute("isBinding"),n.attributes.onbinded){e=Function(n.attributes.onbinded.value);try{e.call(t)}catch(f){console.info("onbinded error: ",f,n.attributes.onbinded.value)}}}},n.GetDatacontext=function(n,t){typeof t=="string"&&(t=document.querySelector(t));var i=u(n,t);return l(i,i.element)},n.GetDatacontextByPath=function(n,t){if(n=JSON.parse(JSON.stringify(n)),n[0]==="."&&(n=n.substr(1)),typeof n=="string"&&(n=n.split(".")),t||(t=window.datacontext),Array.isArray(n))while(n.length&&t)t=t[n.shift()];else return null;return t},n.GetPath=function(t){var i=n.GetDatacontext(".",t);return n.GetPathByItem(i)},n.GetPathByItem=function(n){if(n&&n.parent){var t=[];do n.parentPropertyName&&t.push(n.parentPropertyName),n=n.parent;while(n.parent);return"."+t.reverse().join(".")}return""},n.BindArguments=a,n.BindTemplate=i,window.datacontext=t.Item(),window.datacontext.isModified=!1,r=!1,n.isReady=function(){return r},n.Start=p,addEventListener("load",p),n});