/** Data Binding functions for Browser. @preserve Copyright (c) 2020 Manuel LÃµhmus.*/
(function(n,t){function i(){n.DC?n.DB=t(n.DC):setTimeout(i,10)}n=typeof globalThis!="undefined"?globalThis:n||self;i()})(this,function(n){function o(n,t,r,u){var f,e;n&&n!=="null"&&(f=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),f.open("GET",n),typeof u=="object"&&u!==null&&(e=Object.keys(u),e.forEach(function(n){f.setRequestHeader(n,u[n])})),f.onload=function(){typeof t=="function"&&t(f.responseText,f.status)},f.onerror=function(n){typeof r=="function"&&r(n,f.status)},f.onloadstart=function(){i++},f.onloadend=function(){i--},f.send())}function p(n,t,r,u,f){var e,o;n&&(e=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),e.open("POST",n),typeof f=="object"&&f!==null&&(o=Object.keys(f),o.forEach(function(n){e.setRequestHeader(n,f[n])})),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){typeof r=="function"&&r(e.responseText,e.status)},e.onerror=function(n){typeof u=="function"&&u(n,e.status)},e.onloadstart=function(){i++},e.onloadend=function(){i--},e.send(t))}function w(n){var i=n&&n.attributes&&n.attributes.path?n.attributes.path.value:n.toString(),t;if(i&&typeof i=="string")return t=[],i.split(";").filter(function(n){return n!==undefined}).forEach(function(i){var r=i.replace(/===/,"\0\0\0").replace(/==/,"\0\0").split(/=/).map(function(n){return n.replace(/\0\0\0/,"===").replace(/\0\0/,"==")}),u;r.length===1?(u=r[0][0]==="."?".":"",t=t.concat(s(u,r[0].trim(),n))):t=t.concat(s(r.shift().trim(),r.join("=").trim(),n))}),t}function s(n,t,i){var u=[],f,e,r=h(t,i);return r.isOperators&&(f=r.map(function(n){if(n.type==="path"&&n.value!==undefined&&typeof n.value!="function"){var i=n.keys.join(".");try{n.value&&n.value.value!==undefined&&n.value["-type"]!==undefined&&(i+=".value")}catch(r){console.info("Parsing error!",t,r)}return i}return n.expr}).join(""),e=function(n){return function(){var t,i=Function("return "+n+";");try{t=i.apply(r.element)}catch(u){console.info("Parsing error!",n,u)}return t}}(f)),r.forEach(function(t){t.type==="path"&&u.push({propertyName:n,path:t.expr,value:t.value,getCalcValue:e})}),u}function h(n,t){var i=[],e=t,o=!1,r;if(typeof n=="string"){var f={expr:"",type:"path"};for(i.push(f),r=0;r<n.length;r++)"=+-*/%<>&^|!~?:(),[]".indexOf(n[r])>-1?f.type==="operator"?f.expr+=n[r]:(i.push(f={expr:n[r],type:"operator"}),o=!0):f.type==="path"?f.expr+=n[r]:i.push(f={expr:n[r],type:"path"});i=i.filter(function(n){if(n.expr)return n.type==="path"&&(n.keys=u(n.expr,t),n.value=c(n.keys,n.keys.element),e.datacontext||(e=n.keys.element)),!0})}return i.element=e,i.isOperators=o,i}function u(n,t){function o(n){if(typeof n=="string"){var t=[];return n.split("[").forEach(function(n,i,r){n&&i>0&&r.length>1?n.split("]").forEach(function(n,i){n&&(i===0?((n[0]==="'"||n[0]==='"')&&(n=n.substr(1)),(n[n.length-1]==="'"||n[n.length-1]==='"')&&(n=n.substr(0,n.length-1)),t.push(n)):n.split(".").forEach(function(n){n&&t.push(n)}))}):n&&(t=t.concat(n.split(".")))}),t[0]===""&&(t[0]="datacontext"),t[t.length-1]===""&&t.pop(),t}return[]}var i=o(n),f,s,r,e;if(i.element=t,i[0]==="datacontext"&&n[0]===".")while(i[0]!=="this"&&t&&(t.parentElement||t.parentNode))t=t.parentElement||t.parentNode,t.getAttribute&&(n=t.getAttribute("path")),n&&(f="",n.split(";").forEach(function(n){if(n=n.trim(),(n.substr(0,4)==="this"||n[0]===".")&&n.indexOf("=")<0){f=n;return}}),f&&(s=o(f),i.shift(),i=s.concat(i),i.element=t));else if(i[0]!=="this"&&i[0]!=="window")while(t&&(t.parentElement||t.parentNode&&t.parentNode.getAttribute))t=t.parentElement||t.parentNode,n=t.getAttribute("path"),n&&(r="",n.split(";").forEach(function(n){if(n[0]!=="."&&n.indexOf("=")<0){r=n.trim();return}}),r&&r.substr(0,4)!=="this"&&(e=u(r),e.element=i.element,i=e.concat(i),i.element=e.element));return i}function c(i,r){var u=window;return i&&typeof i.forEach=="function"&&i.forEach(function(f){if(f==="window")u=window;else if(f==="this")u=r;else if(u)t.IsAutoProperty&&f!=="value"&&!u[f]&&typeof u.defineProperty=="function"&&(u.defineProperty(f,n.Item()),console.info("AutoProperty!","'"+f+"'",i.join("."))),u=u[f];else return}),u}function l(n){n&&(n.path&&n.path.length&&n.path.forEach&&n.path.forEach(function(i){if(i&&i.path&&i.value!==undefined)try{if(i.value&&i.value.isCollection)n.element.setAttribute("collection","true"),n.element.removeBinding=typeof n.callback=="function"?i.value.addBindCollection(n.callback,n.element):i.value.addBindCollection(b(i,n),n.element);else if(i&&i.value&&i.value.parentPropertyName){var r=i.value.parentPropertyName,u=i.value.parent;r!==undefined&&r!==null&&typeof u.addBind=="function"&&(n.element.removeBinding=typeof n.callback=="function"?u.addBind(r,n.callback,n.element):u.addBind(r,function(r,u,f){if(n.template&&v("template",n.element)!==n.template&&(!i.propertyName||i.propertyName===".datacontext")){u.innerHTML=n.template;var e=u.lastElementChild;e.datacontext=r;t.BindAll(e)}else a(i)(r,u,f)},n.element))}else i&&typeof i.getCalcValue=="function"?i.propertyName[0]==="."?n.element[i.propertyName.slice(1)]=i.getCalcValue():i.propertyName?n.element.setAttribute(i.propertyName,i.getCalcValue()):i.getCalcValue():i&&typeof i.value=="function"?i.propertyName[0]==="."?n.element[i.propertyName.slice(1)]=i.value():i.propertyName?n.element.setAttribute(i.propertyName,i.value()):i.value():i.propertyName&&(i.propertyName[0]==="."?n.element[i.propertyName.slice(1)]=i.value:n.element.setAttribute(i.propertyName,i.value))}catch(f){console.info("Binding error!",i.path,f)}}),n.template&&n.element.getAttribute("collection")!=="true"&&!n.element.attributes.onbind&&(n.element.innerHTML=n.template,n.element.removeAttribute("template"),t.BindChildren(n.element)),n.templateid&&n.element.getAttribute("collection")!=="true"&&!n.element.attributes.onbind&&(n.element.innerHTML="",n.element.removeAttribute("templateid"),e(n.templateid,function(t){r(t,n.element,n.datacontext)})))}function b(n,i){return function(u,o,s){function h(t,u){function f(){t&&t.items&&t.items.forEach&&t.items.forEach(function(t){if(!t["-deleted"])if(i.template)r(i.template,u,t,n.path,t.parentPropertyName);else{var f=document.createElement("div");u.appendChild(f);f.removeBinding=n.value.addBind(t.parentPropertyName,a(n),f)}})}i.templateid?e(i.templateid,function(n){i.template=n;f()}):f()}function c(n,t){n&&n.items&&n.items.forEach&&n.items.forEach(function(n){for(var i=t.querySelectorAll("[name='"+n.parentPropertyName+"']"),r=i.length-1;i&&r>-1;r--)try{t.removeChild(i[r])}catch(u){console.info(u)}})}if(s&&s.newValue&&s.oldValue&&s.newValue["-type"]!==s.oldValue["-type"]){typeof o.removeBinding=="function"&&o.removeBinding();f(o);t.BindAll(o);return}if(u)switch(u.action){case"addBind":f(o);h(u,o);break;case"add":h(u,o);break;case"remove":c(u,o);break;case"modified":f(o);u.items=[];u.source.forEach(function(n){u.items.push(n)});h(u,o)}}}function f(n){if(n&&n.children&&n.removeChild)for(var t=n.children;n.children.length>0;)t[0].tagName&&t[0].tagName.toLowerCase()!=="template"&&n.removeChild(t[0])}function e(n,i,r){var u=t.BindDisableCache?{Pragma:"no-cache","Cache-Control":"no-store, no-cache, must-revalidate, post-check=0, pre-check=0",Expires:-1,"Last-Modified":Date(0),"If-Modified-Since":Date(0)}:null;o(n,i,r,u)}function k(n,t,i){var r,u,f;if(i=i?i:"",r=i[0]==="."||i.startsWith("this")?".":"",r)if(t&&n.attributes.path){if(i=n.attributes.path.value,i)return u=!1,f=i.split(";").filter(function(n){return n}).map(function(n){if(n){var t=n.split("=");if(t.length===1)return u=!0,{property:"",path:t[0].trim()};if(t.length===2)return{property:t.shift(),path:t.join("=").trim()}}}).map(function(i){return!i||i.property+"="+h(i.path,n).map(function(n){return n.type==="path"&&n.expr[0]==="."&&t.parentPropertyName.toString()?r+t.parentPropertyName+n.expr:n.expr}).join("")}).join(";"),u||(f+=t.parentPropertyName.toString()?";"+r+t.parentPropertyName:""),f}else if(t&&t.parentPropertyName)return r+t.parentPropertyName}function r(n,i,r,u,f){var o,e,s;if(n)for(o=i.parentElement?document.createElement(i.nodeName):document.createElementNS(i.namespaceURI,i.nodeName),o.innerHTML=n;o.childNodes.length>0;)e=o.childNodes[0],e.nodeName.toLowerCase()==="script"?(t.AddScript(e.innerHTML,i),o.removeChild(e)):(i.appendChild(e),e.tagName&&(s=k(e,r,u),s!==undefined&&e.setAttribute("path",s),f!==undefined&&e.setAttribute("name",f),r!==undefined&&(e.datacontext=r),i.parentElement&&t.BindAll(e)))}function a(n){return function(i,u){var f,s,o;if(!t.BindDisable){if(n&&n.propertyName==="."||!n.propertyName){typeof n.getCalcValue=="function"&&n.getCalcValue();return}if(n.propertyName==="template"){u.innerHTML=n.value+"";t.BindChildren(u);return}if(n.propertyName==="templateid"){u.innerHTML="";e(n.value+"",function(n){r(n,u,t.GetDatacontext(".",u))});return}if(n&&n.propertyName)if(f=typeof n.getCalcValue=="function"?n.getCalcValue():i,(f===undefined||f===null)&&(f=i),f=f===undefined||f===null?"":f,f&&f.value!==undefined&&(f=f.value),n.propertyName[0]===".")try{for(s=n.propertyName.split(".").filter(function(n){return n?!0:!1}),o=u;o&&s.length>1;)o=o[s.shift()];o[s.shift()]=t.IsDebuger||f!==undefined&&f!==null?f:""}catch(h){console.info("Default callback error!",h)}else f?u.parentElement?u.setAttribute(n.propertyName,f.toString()):u.setAttributeNS(u.namespaceURI,n.propertyName,f.toString()):u.removeAttribute(n.propertyName);(n.propertyName.toLowerCase()==="value"||n.propertyName.toLowerCase()===".value")&&(u.tagName.toLowerCase()==="input"||u.tagName.toLowerCase()==="select"||u.tagName.toLowerCase()==="textarea")&&(u.onchange=function(n){return n[0]==="."&&(n=n.substr(1)),function(){i&&i.parent&&typeof i.parent.setValue=="function"&&i.parentPropertyName&&i.parent.setValue(i.parentPropertyName,this[n])}}(n.propertyName),u.onkeydown=function(t){return t[0]==="."&&(t=t.substr(1)),function(){if(event.keyCode===27){var r=typeof n.getCalcValue=="function"?n.getCalcValue():i;(r===undefined||r===null)&&(r=i);r=r===undefined||r===null?"":r;r&&r.value!==undefined&&(r=r.value);this[t]=r}}}(n.propertyName));u.getAttribute("onclick")||n.propertyName.toLowerCase()!=="checked"&&n.propertyName.toLowerCase()!==".checked"||u.tagName.toLowerCase()!=="input"||(u.onclick=function(n){return n[0]==="."&&(n=n.substr(1)),function(){i&&i.parent&&typeof i.parent.setValue=="function"&&i.parentPropertyName&&i.parent.setValue(i.parentPropertyName,this[n]?!0:!1)}}(n.propertyName))}}}function v(n,t){if(n&&t&&t.parentElement)return t.parentElement.attributes[n]?t.parentElement.attributes[n].value:v(n,t.parentElement)}function d(){i=0;t.Ajax||(t.Ajax=n.Item({progressCount:i}));window.datacontext=n.Item();window.datacontext.isModified=!1;var r=document.getElementById("datacontext");if(r)try{r=JSON.parse(r.innerHTML);window.datacontext.init(r)}catch(u){this.console.info("error: loading 'datacontext' in scriptTextHtml",u)}setTimeout(function(){t.BindAll()},10)}function y(){document.readyState=="complete"?t.Start():setTimeout(y,10)}if(!n)throw new Error("Data Binding depends npm 'data-context'");String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(n,t){var i=t>0?t|0:0;return typeof n=="string"&&this.substring(i,i+n.length)===n}});String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(n,t){return t=t===undefined||t>this.length?this.length:t,typeof n=="string"&&this.substring(t-n.length,t)===n}});String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{value:function(n){return this.startsWith(n)?this.substring(n.length):this.replace(/^[\s\uFEFF\xA0]+/g,"")}});String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{value:function(n){return this.endsWith(n)?this.substring(0,this.length-n.length):this.replace(/[\s\uFEFF\xA0]+$/g,"")}});String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(n){return this.indexOf(n)>-1}});Math.cbrt||Object.defineProperty(Math,"cbrt",{value:function(n){return n<0?-Math.pow(-n,1/3):Math.pow(n,1/3)}});var t={},i=0;return t.GET=o,t.POST=p,t.AddScript=function(n,t){var i=document.createElement("script");i.type="text/javascript";try{i.appendChild(document.createTextNode(n));t?t.appendChild(i):document.body.appendChild(i)}catch(r){i.text=n;t?t.appendChild(i):document.body.appendChild(i)}},t.CleanElement=function(n){var i,t,r;if(n)for(i=n.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),t=0;t<i.length;t++)i[t].parentElement&&i[t].parentElement.removeChild(i[t]);while(n&&n.childNodes.length)r=n.childNodes["0"],n.removeChild(n.childNodes["0"])},t.BindAll=function(n){var r,i;if((n||(n=document),!n.attributes||!n.attributes.isBinding)&&(!n.attributes||!n.attributes.isbinding)&&(!n.attributes||!n.attributes.isBinded)&&(!n.attributes||!n.attributes.isbinded))for(r=n.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),t.BindElement(n),i=0;i<r.length;i++)t.BindElement(r[i])},t.Bind=function(n){t.BindElement(n);t.BindChildren(n)},t.BindChildren=function(n){var r,i;if(n&&n.querySelectorAll)for(r=n.querySelectorAll("[template],[templateid],[datacontext],[path],[onbind],[onbinded]"),i=0;i<r.length;i++)t.BindElement(r[i])},t.BindElement=function(n){var t,r,i,o,u,e;if(n&&n.attributes&&!n.attributes.isBinding&&!n.attributes.isbinding&&!n.attributes.isBinded&&!n.attributes.isbinded&&(!n.tagName||n.tagName.toLowerCase()!=="template")&&(n.attributes.templateid||n.attributes.template||n.attributes.path||n.attributes.onbind||n.attributes.onbinded)){if(n.setAttribute("isBinding","true"),t={element:n,datacontext:n.datacontext,templateid:null,template:null,path:[],callback:null},n.attributes.templateid&&(r=n.attributes.templateid.value,i=document.getElementById(r),i&&i.innerHTML?t.template=i.innerHTML:t.templateid=r),n.attributes.template&&(t.template=n.attributes.template.value),n.attributes.path&&(t.path=w(n)),n.attributes.onbind){u=Function(n.attributes.onbind.value);try{o=u.apply(t)}catch(f){console.info("onbind error!",f,n.attributes.onbind?n.attributes.onbind.value:undefined)}}if(l(t),n.removeAttribute("isBinding"),n.attributes.onbinded){e=Function(n.attributes.onbinded.value);try{e.apply(t)}catch(f){console.info("onbinded error: ",f,n.attributes.onbinded.value)}}}},t.GetDatacontext=function(n,t){typeof t=="string"&&(t=document.querySelector(t));var i=u(n,t);return c(i,i.element)},t.GetDatacontextByPath=function(n,t){if(n=JSON.parse(JSON.stringify(n)),n[0]==="."&&(n=n.substr(1)),typeof n=="string"&&(n=n.split(".")),t||(t=window.datacontext),Array.isArray(n))while(n.length&&t)t=t[n.shift()];else return null;return t},t.GetPath=function(n){var i=t.GetDatacontext(".",n);return t.GetPathByItem(i)},t.GetPathByItem=function(n){if(n&&n.parent){var t=[];do n.parentPropertyName&&t.push(n.parentPropertyName),n=n.parent;while(n.parent);return"."+t.reverse().join(".")}return""},t.BindArguments=l,t.BindTemplate=r,t.Start=d,y(),t});